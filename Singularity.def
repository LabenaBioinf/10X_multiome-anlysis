Bootstrap: library
From: ubuntu:20.04

%labels
    Maintainer: /
    R_Version: 4.1.3

%post
    # Update package lists
    apt-get update

    # Install essential system dependencies
    apt-get install -y software-properties-common
    apt-get install -y apt-transport-https
    apt-get install -y ca-certificates
    apt-get install -y gnupg

    # Add CRAN repository
    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 51716619E084DAB9
    add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"

    # Update package lists again
    apt-get update

    # Install R base
    apt-get install -y r-base-core=4.1.3-1.2004.0

    # Install remaining system dependencies (one by one)
    apt-get install -y libgsl-dev
    apt-get install -y libcurl4-openssl-dev
    apt-get install -y libssl-dev
    apt-get install -y libxml2-dev
    apt-get install -y libglpk-dev
    apt-get install -y libgmp-dev
    apt-get install -y libblas-dev
    apt-get install -y liblapack-dev
    apt-get install -y libcairo2-dev
    apt-get install -y libcurl4-gnutls-dev
    apt-get install -y gfortran
    apt-get install -y libharfbuzz-dev
    apt-get install -y libfribidi-dev
    apt-get install -y libfreetype6-dev
    apt-get install -y libpng-dev
    apt-get install -y libtiff5-dev
    apt-get install -y libjpeg-dev
    apt-get install -y libhdf5-dev
    apt-get install -y build-essential
    apt-get install -y libbz2-dev
    apt-get install -y libfftw3-3 
    apt-get install -y libfftw3-dev
    apt-get install -y libudunits2-dev
    apt-get install -y libgdal-dev
    apt-get install -y libproj-dev
    apt-get install -y libgeos-dev
    apt-get install -y libx11-dev
    apt-get install -y mesa-common-dev
    apt-get install -y libglu1-mesa-dev
    apt-get install -y libmpfr-dev
    apt-get install -y libv8-dev
    apt-get install -y libjq-dev
    apt-get install -y libprotobuf-dev
    apt-get install -y protobuf-compiler
    apt-get install -y libmagick++-dev
    apt-get install -y libtesseract-dev
    apt-get install -y tesseract-ocr-eng
    apt-get install -y libgit2-dev
    apt-get install -y libz-dev
    apt-get install -y liblzma-dev
    apt-get install -y pandoc
    apt-get install -y pandoc-citeproc
    apt-get install -y cmake
    apt-get install -y git
    apt-get install -y wget

    # Install R pacakges
    R -e "setRepositories(ind = 1:3)"
    R -e "install.packages('BiocManager', repos='https://cran.rstudio.com/', version='1.30.22')"
    R -e "BiocManager::install('remotes')"

    R -e "remotes::install_version('Matrix', version='1.6-5')"
    R -e "remotes::install_version('MASS', version='7.3-55')"

    R -e "BiocManager::install('Signac')"
    R -e "install.packages('Seurat')"

    R -e "remotes::install_version('rjson', version='0.2.21')"
    R -e "BiocManager::install('biovizBase')"
    R -e "BiocManager::install('glmGamPoi')"

    R -e "BiocManager::install('scDblFinder')"
    R -e "BiocManager::install('BiocParallel')"

    R -e "BiocManager::install('BSgenome.Hsapiens.UCSC.hg38')"
    R -e "BiocManager::install('EnsDb.Hsapiens.v86')"

    R -e "remotes::install_github('mojaveazure/seurat-disk')"

    R -e "remotes::install_github('immunogenomics/presto')"
    R -e "remotes::install_github('cysouw/qlcMatrix')"

    R -e "remotes::install_github('YuLab-SMU/ggtree')"
    R -e "remotes::install_github('carmonalab/UCell', ref='v1.3')"
    R -e "remotes::install_github('chuiqin/irGSEA')"
    R -e "BiocManager::install('RcppML')"

    R -e "BiocManager::install('escape')"
    R -e "BiocManager::install('dittoSeq')"

    R -e "remotes::install_version('pbkrtest', version='0.5.2')"
    R -e "install.packages('ggpubr')"
    R -e "remotes::install_version('lda', version='1.4.2')"
    wget https://github.com/aertslab/cisTopic/archive/refs/tags/v2.1.0.tar.gz
    R -e "remotes::install_local('v2.1.0.tar.gz')"
    R -e "install.packages('umap')"
    R -e "remotes::install_github('caleblareau/BuenColors')"
    R -e "BiocManager::install('chromVAR')"
    R -e "BiocManager::install('motifmatchr')"
    R -e "BiocManager::install('ComplexHeatmap')"
    R -e "install.packages('Rmpfr')"
    R -e "install.packages('optmatch')"
    R -e "remotes::install_github('buenrostrolab/FigR')"
    R -e "install.packages('doParallel')"
    R -e "install.packages('ggrastr')"
    R -e "install.packages('networkD3')"
    R -e "install.packages('r2d3')"
    R -e "remotes::install_github('dahtah/imager')"
    
    R -e "install.packages('ggforce')"
    R -e "remotes::install_github('ctlab/fgsea')"
    R -e "install.packages('tibble')"

    R -e "remotes::install_version('matrixStats', version='1.1.0')"
